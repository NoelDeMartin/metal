#!/bin/bash

if [ -z "$METAL_HOME" ]
then
    echo "METAL_HOME env variable not set"
    exit
fi

export PROJECT_PATH=`pwd`
export PROJECT_NAME=${PWD##*/}

COMMAND=$1
if [ -z "$2" ]; then
    export METAL_CONTAINER="$PROJECT_NAME"
else
    export METAL_CONTAINER="$2"
fi

OPTIONS=`getopt --longoptions=debug --name "$0" -- "$@"`
eval set -- "$OPTIONS"
while true; do
    case "$1" in
        -d|--debug)
            export METAL_DEBUG=true
            shift
            ;;
        --)
            shift
            break
            ;;
        *)
            echo "Programming error"
            exit 3
            ;;
    esac
done

if [ -e "$METAL_HOME/commands/$COMMAND.sh" ]; then
    bash "$METAL_HOME/commands/$COMMAND.sh"
else
    echo "Unknown command \"$COMMAND\""
fi
